# LinkedIn Selector API Documentation

This API allows you to test and update LinkedIn selectors against real profiles to ensure your scraping functionality continues to work correctly as LinkedIn's website changes.

## Features

- Verify LinkedIn selectors against a specific profile URL or the latest lead in your database
- Get detailed metrics about which selectors are working well and which need attention
- Analyze selector performance by category
- Automatically use an authenticated LinkedIn account to access profile data
- Generate new selectors through HTML analysis when all existing selectors are failing

## API Endpoints

### Verify Selectors

**Endpoint:** `POST /api/linkedin/selectors/verify`

This endpoint tests all LinkedIn selectors against a profile and returns health metrics for each selector.

**Request Body:**

```json
{
	"linkedinAccountId": "6123456789abcdef01234567", // MongoDB ID of your LinkedIn account
	"password": "your-linkedin-password", // LinkedIn account password
	"profileUrl": "https://www.linkedin.com/in/johndoe/", // URL of LinkedIn profile to test against
	"useLatestLead": false, // Alternatively, set to true to use latest lead's profile
	"proxyId": "6123456789abcdef01234567", // Optional: MongoDB ID of proxy to use
	"outputPath": "./selectors-health.json" // Where to save the metrics results
}
```

**Response:** JSON object with metrics for each selector

### Update Selectors

**Endpoint:** `POST /api/linkedin/selectors/update`

This endpoint analyzes selector health metrics and updates poor-performing selectors. It can also generate new selectors for categories where all selectors are failing.

**Request Body:**

```json
{
	"metricsPath": "./selectors-health.json", // Path to metrics file from verify endpoint
	"threshold": 0.5, // Success rate threshold (0-1)
	"category": ["Profile Headline", "Skills"], // Optional: Categories to focus on (string or array)
	"updateSelectorFile": true, // Whether to update the selectors file
	"selectorFile": "./data/selectors.json", // Path to selectors file to update
	"generateNewSelectors": true, // Whether to generate new selectors for failing categories
	"profileUrl": "https://www.linkedin.com/in/johndoe/", // Required for generating new selectors
	"linkedinAccountId": "6123456789abcdef01234567", // Required for generating new selectors
	"password": "your-linkedin-password", // Required for generating new selectors
	"proxyId": "6123456789abcdef01234567" // Optional: Proxy for generating new selectors
}
```

**Response:** JSON object with analysis results and updates made

## How Selector Generation Works

When using the `generateNewSelectors: true` option, the system will:

1. Analyze selector health metrics to identify categories with no working selectors
2. Login to LinkedIn using the provided account credentials
3. Navigate to the specified profile URL
4. For each failing category:
    - Try multiple selector generation strategies:
        - Test basic selectors (h1, h2, common class patterns, etc.)
        - Enhance working selectors with more specific attributes and context
        - Use semantic search to find elements containing relevant keywords
    - Test all generated selectors to verify they work
    - Keep only the selectors that successfully find visible elements with content
5. Update the selectors file with the newly generated selectors
6. Add fallback selectors from defaults as a safety measure

This automated process helps maintain working selectors even as LinkedIn frequently changes their HTML structure.

## Usage Notes

- When using the `verify` endpoint, you must provide either `profileUrl` or `useLatestLead` (or both).
- The `verify` endpoint requires a LinkedIn account ID with valid credentials.
- The `update` endpoint analyzes the metrics file generated by the `verify` endpoint.
- The `category` parameter in the `update` endpoint can be a single string or an array of strings to process multiple categories at once.
- If no category is specified in the `update` endpoint, all categories will be processed.
- Set `updateSelectorFile` to `true` to automatically update your selectors file with recommended changes.

## Authentication

Both endpoints require admin authentication. Include the admin JWT token in the Authorization header:

```
Authorization: Bearer <adminToken>
```

## See Also

For Postman usage examples, see [README-POSTMAN-SELECTORS.md](README-POSTMAN-SELECTORS.md)

## Using with the Existing Postman Collection

The LinkedIn selector API endpoints have been integrated into the existing "LinkedIn Scraper API" Postman collection in a new folder called "LinkedIn Selectors".

### Setup:

1. Use the latest version of the "LinkedIn Scraper API.postman_collection.json" collection
2. Use the "LinkedIn Scraper API Environment.postman_environment.json" environment
3. Make sure the following environment variables are set:
    - `baseUrl`: Your API base URL (e.g., `http://localhost:4001`)
    - `adminToken`: Admin JWT token for authentication (required for these endpoints)
    - `linkedinAccountId`: MongoDB ID of the LinkedIn account to use
    - `linkedinAccountPass`: Password for the LinkedIn account
    - `proxyId`: MongoDB ID of a proxy to use (optional)
    - `selectorsOutputPath`: Path where selector metrics will be saved
    - `selectorThreshold`: Threshold value for identifying poor selectors (default: 0.5)

### Using the Endpoints:

1. Log in as an admin using the "Login Admin" request in the "Auth" folder
2. Look for the "LinkedIn Selectors" folder in the collection
3. Use "Verify Selectors with ProfileURL" to test against a specific LinkedIn profile
4. Use "Verify Selectors with Latest Lead" to test against the most recent lead in your database
5. Use "Update Selectors" to analyze the generated metrics file and get recommendations

### Detailed Postman Guide:

For a detailed guide on using these endpoints in Postman, refer to the `README-POSTMAN-SELECTORS.md` file in the project root. This guide provides step-by-step instructions, example workflows, and troubleshooting tips.

## Integration Notes

- These endpoints are secured with admin-only access
- The LinkedIn account needs to be properly authenticated to access profile data
- The verification process may take 1-2 minutes to complete as it tests many selectors
- Consider setting up scheduled verification (e.g., weekly) to catch LinkedIn UI changes early

## Troubleshooting

- If you encounter CAPTCHA or verification challenges, try using a different LinkedIn account
- If certain selectors consistently fail, consider examining the HTML structure of LinkedIn profiles
- Check the server logs for more detailed information about selector performance
- Use a reliable LinkedIn account that's not rate-limited or recently used for scraping

---

For detailed implementation of these APIs, see:

- `src/routes/linkedin.routes.ts` - API routes
- `src/controllers/linkedin.controller.ts` - Controller logic
- `src/services/linkedin/SelectorVerifier.ts` - Verification implementation
- `src/services/linkedin/LinkedInProfileScraper.ts` - Profile interaction logic
